"use strict";(self.webpackChunk_kne_components_components_ckeditor=self.webpackChunk_kne_components_components_ckeditor||[]).push([[637],{2399:(t,e,a)=>{a.r(e),a.d(e,{default:()=>n});var o=a(4037);class s{constructor(t,e){this.loader=t,this.options=e,this.base64MaxWidth=e.base64MaxWidth||600,this.base64MaxHeight=e.base64MaxHeight||600}async upload(){const t=await this.loader.file;if("function"!==typeof this.options.upload){console.warn("\u5f53\u524d\u56fe\u7247\u4e0a\u4f20\u4e3abase64\u6a21\u5f0f\uff0c\u6b63\u5f0f\u73af\u5883\u8bf7\u5728preset apis\u8bbe\u7f6efile.upload,\u6216\u8005\u7ed9CKEditor\u7ec4\u4ef6\u4f20\u5165 config.ossUpload.upload\u53c2\u6570");const o=await new Promise((e=>{const a=new FileReader;a.onload=()=>{e(a.result)},a.readAsDataURL(t)}));return{default:await(e=o,a=this.base64MaxWidth,s=this.base64MaxHeight,new Promise(((t,o)=>{const n=new Image;n.src=e,n.onload=function(){const e=document.createElement("canvas"),o=e.getContext("2d"),i=n.width/a,r=n.height/s,l=Math.max(i,r,1);e.width=n.width/l,e.height=n.height/l,o.drawImage(n,0,0,e.width,e.height);const c=e.toDataURL("image/png");t(c)},n.onerror=function(t){o(t)}})))}}var e,a,s;const{data:n}=await this.options.upload({file:t});return 0!==n.code?(this.options.message.error(n.msg),{default:o.A}):{default:n.data}}}const n=function(t){const e=t.config.get("message"),a=Object.assign({},{message:e},t.config.get("ossUpload"));t.plugins.get("FileRepository").createUploadAdapter=t=>new s(t,a),t.editing.view.document.on("clipboardInput",((s,n)=>{if(t.isReadOnly)return;const i=n.dataTransfer.getData("text/html"),r=(new DOMParser).parseFromString(i,"text/html");if(0===r.querySelectorAll("img").length)return;n.content=t.data.htmlProcessor.toView("");const l=e.loading("\u7c98\u8d34\u5185\u5bb9\u4e2d\u542b\u6709\u56fe\u7247\uff0c\u6b63\u5728\u8fdb\u884c\u56fe\u7247\u4e0a\u4f20...",{duration:0});Promise.all([].slice.call(r.querySelectorAll("img"),0).map((async t=>{if("function"!==typeof a.uploadUrl)return void console.warn("\u56fe\u7247\u4e0a\u4f20\u5931\u8d25\uff0c\u8bf7\u5728preset apis\u8bbe\u7f6efile.uploadUrl,\u6216\u8005\u7ed9CKEditor\u7ec4\u4ef6\u4f20\u5165 config.ossUpload.uploadUrl\u53c2\u6570");const{code:e,data:s,msg:n}=await a.uploadUrl({url:t.src});if(0!==e)return console.warn(`\u56fe\u7247\u4e0a\u4f20\u5931\u8d25\uff0c${n}`),void(t.src=o.A);t.src=s}))).then((()=>{t.model.insertContent(t.data.toModel(t.data.htmlProcessor.toView(r.documentElement.outerHTML)))})).finally((()=>{l()}))}))}},4037:(t,e,a)=>{a.d(e,{A:()=>o});a(3884);const o=a.p+"static/media/img_fail.92f698baf5c5ad60bf4437eb46f9525a.svg"}}]);
//# sourceMappingURL=637.7122e7fa.chunk.js.map