"use strict";(self.webpackChunk_kne_components_components_ckeditor=self.webpackChunk_kne_components_components_ckeditor||[]).push([[986],{77986:(t,e,o)=>{o.r(e),o.d(e,{default:()=>c});const i=t=>{let{core:e,widget:o}=t;const{Command:i,Plugin:n}=e,{toWidget:s,Widget:r}=o;class c extends i{execute(t){let{type:e,props:o}=t;this.editor.model.change((t=>{this.editor.model.insertContent(t.createElement("componentBox",{"data-type":e,"data-props":o}))}))}refresh(){const t=this.editor.model,e=t.document.selection,o=t.schema.findAllowedParent(e.getFirstPosition(),"componentBox");this.isEnabled=null!==o}}return class extends n{static get requires(){return[r]}init(){this._defineSchema(),this._defineConverters(),this.editor.commands.add("insertComponentBox",new c(this.editor))}_defineSchema(){this.editor.model.schema.register("componentBox",{inheritAllFrom:"$blockObject",allowAttributes:["data-type","data-props"]})}_defineConverters(){var t;const e=this.editor,o=e.conversion,i=(null===(t=e.config.get("componentBox"))||void 0===t?void 0:t.list)||[];o.for("upcast").elementToElement({model:(t,e)=>{let{writer:o}=e;const i=t.getAttribute("data-props"),n=t.getAttribute("data-type");return o.createElement("componentBox",{"data-type":n,"data-props":i})},view:{name:"section",classes:"component-box"}});const n=(t,e)=>{let{writer:o}=e;const n=t.getAttribute("data-type"),s=t.getAttribute("data-props"),r=o.createContainerElement("section",{class:"component-box","data-type":n,"data-props":JSON.stringify(s)}),c=o.createRawElement("div",{class:"component-box-wrapper"},(t=>{var e,o;null===(e=i.find((t=>t.type===n)))||void 0===e||null===(o=e.render)||void 0===o||o.call(e,t,s)}));return o.insert(o.createPositionAt(r,0),c),r};o.for("dataDowncast").elementToElement({model:"componentBox",view:(t,e)=>{let{writer:o}=e;return n(t,{writer:o})}}),o.for("editingDowncast").elementToElement({model:"componentBox",view:(t,e)=>{let{writer:o}=e;const i=n(t,{writer:o});return s(i,o,{label:"component box widget",hasSelectionHandle:!0})}})}}},n=t=>{let{core:e,ui:o}=t;const{Plugin:i}=e,{addToolbarToDropdown:n,ButtonView:s,createDropdown:r,View:c}=o;class l extends c{constructor(t,e){super(t),this.children=e,this.setTemplate({tag:"div",attributes:{class:["ck","ck-style-grid"],role:"listbox"},children:this.children})}}return class extends i{init(){var t;const e=this.editor,o=e.t,i=(null===(t=e.config.get("componentBox"))||void 0===t?void 0:t.list)||[];0!==i.length&&e.ui.componentFactory.add("componentBox",(t=>{const c=r(t);c.buttonView.set({withText:!1,label:o("ComponentBox"),icon:'<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1696642601020" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="10458" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M384 480h-128c-52.8 0-96-43.2-96-96v-128c0-52.8 43.2-96 96-96h128c52.8 0 96 43.2 96 96v128c0 52.8-43.2 96-96 96z m-128-256c-17.6 0-32 14.4-32 32v128c0 17.6 14.4 32 32 32h128c17.6 0 32-14.4 32-32v-128c0-17.6-14.4-32-32-32h-128zM768 480h-128c-52.8 0-96-43.2-96-96v-128c0-52.8 43.2-96 96-96h128c52.8 0 96 43.2 96 96v128c0 52.8-43.2 96-96 96z m-128-256c-17.6 0-32 14.4-32 32v128c0 17.6 14.4 32 32 32h128c17.6 0 32-14.4 32-32v-128c0-17.6-14.4-32-32-32h-128zM384 864h-128c-52.8 0-96-43.2-96-96v-128c0-52.8 43.2-96 96-96h128c52.8 0 96 43.2 96 96v128c0 52.8-43.2 96-96 96z m-128-256c-17.6 0-32 14.4-32 32v128c0 17.6 14.4 32 32 32h128c17.6 0 32-14.4 32-32v-128c0-17.6-14.4-32-32-32h-128zM768 864h-128c-52.8 0-96-43.2-96-96v-128c0-52.8 43.2-96 96-96h128c52.8 0 96 43.2 96 96v128c0 52.8-43.2 96-96 96z m-128-256c-17.6 0-32 14.4-32 32v128c0 17.6 14.4 32 32 32h128c17.6 0 32-14.4 32-32v-128c0-17.6-14.4-32-32-32h-128z" p-id="10459"></path></svg>',tooltip:!0});const a=new l(t,i.map((o=>{let{type:i,name:n,defaultProps:r}=o;const c=new s(t);return c.set({label:n,withText:!0,tooltip:!0}),this.listenTo(c,"execute",(()=>e.execute("insertComponentBox",{type:i,props:r||{}}))),c})));return n(c,[a]),c}))}}},s=t=>{let{core:e}=t;const{Plugin:o}=e;return class extends o{constructor(){super(...arguments),this.getClosestSelectedWidget=t=>{const e=this.editor.editing.mapper;if(!t.getFirstPosition())return null;const o=t.getSelectedElement();return o&&"componentBox"===e.toModelElement(o).name?o:null}}static get pluginName(){return"ComponentBoxUtil"}}},r=t=>{let{core:e,ui:o,widget:i}=t;const{icons:n,Plugin:r}=e,{BalloonPanelView:c,ButtonView:l,ContextualBalloon:a,createLabeledInputText:h,CssTransitionDisablerMixin:d,LabeledFieldView:u,LabelView:p,submitHandler:m,View:w}=o,{WidgetToolbarRepository:g}=i,v=s({core:e,ui:o,widget:i});function x(t){const e=t.editing.view,o=c.defaultPositions,i=t.plugins.get("ComponentBoxUtil");return{target:e.domConverter.mapViewToDom(i.getClosestSelectedWidget(e.document.selection)),positions:[o.northArrowSouth,o.northArrowSouthWest,o.northArrowSouthEast,o.southArrowNorth,o.southArrowNorthWest,o.southArrowNorthEast,o.viewportStickyNorth]}}class b extends w{constructor(t){super(t),this.abbrInputView=this._createInput("Add abbreviation"),this.titleInputView=this._createInput("Add title"),this.saveButtonView=this._createButton("Save",n.check,"ck-button-save"),this.saveButtonView.type="submit",this.cancelButtonView=this._createButton("Cancel",n.cancel,"ck-button-cancel");const e=new p(t);e.text="\u7ec4\u4ef6\u5c5e\u6027",this.childViews=this.createCollection([e,this.abbrInputView,this.titleInputView,this.saveButtonView,this.cancelButtonView]),this.setTemplate({tag:"form",attributes:{class:["ck","ck-abbr-form"],tabindex:"-1"},children:this.childViews})}render(){super.render(),m({view:this})}focus(){this.childViews.first.focus()}_createInput(t){const e=new u(this.locale,h);return e.label=t,e}_createButton(t,e,o){const i=new l;return i.set({label:t,icon:e,tooltip:!0,class:o}),i}}class _ extends r{static get requires(){return[b,a,v]}static get pluginName(){return"ComponentBoxToolbarUI"}get _isVisible(){return!!this._balloon&&this._balloon.visibleView===this._form}get _isInBalloon(){return!!this._balloon&&this._balloon.hasView(this._form)}destroy(){super.destroy(),this._form&&this._form.destroy()}_createButton(){const t=this.editor,e=t.t;t.ui.componentFactory.add("componentBoxProps",(o=>{t.commands.get("componentBoxProps");const i=new l(o);return i.set({label:e("\u5c5e\u6027\u8bbe\u7f6e"),icon:'<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1696668156648" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5490" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M323.333 653.333c-16.8 0-30 13.2-30 30s13.2 30 30 30c16.8 0 30-13.2 30-30 0-16.8-13.2-30-30-30zM323.333 293.333c-16.8 0-30 13.2-30 30s13.2 30 30 30c16.8 0 30-13.2 30-30 0-16.8-13.2-30-30-30zM323.333 473.333c-16.8 0-30 13.2-30 30s13.2 30 30 30c16.8 0 30-13.2 30-30 0-16.8-13.2-30-30-30zM773.333 113.333h-540c-66 0-120 54-120 120v540c0 66 54 120 120 120h540c66 0 120-54 120-120v-540c0-66-54-120-120-120zM833.333 773.333c0 33-27 60-60 60h-540c-33 0-60-27-60-60v-540c0-33 27-60 60-60h540c33 0 60 27 60 60v540zM683.333 293.333h-240c-16.8 0-30 13.2-30 30s13.2 30 30 30h240c16.8 0 30-13.2 30-30s-13.2-30-30-30zM683.333 473.333h-240c-16.8 0-30 13.2-30 30s13.2 30 30 30h240c16.8 0 30-13.2 30-30s-13.2-30-30-30zM683.333 653.333h-240c-16.8 0-30 13.2-30 30s13.2 30 30 30h240c16.8 0 30-13.2 30-30s-13.2-30-30-30z" fill="#272636" p-id="5491"></path></svg>',tooltip:!0}),this.listenTo(i,"execute",(()=>{this._showForm()})),i}))}_createForm(){const t=this.editor,e=t.editing.view,o=e.document,i=t.plugins.get("ComponentBoxUtil");this._balloon=this.editor.plugins.get("ContextualBalloon"),this._form=new(d(b))(t.locale),this._form.render(),this.listenTo(this._form,"submit",(()=>{this._hideForm(!0)})),this.listenTo(this._form,"cancel",(()=>{this._hideForm(!0)})),console.log(e.keystrokes),this.listenTo(t.ui,"update",(()=>{i.getClosestSelectedWidget(o.selection)?this._isVisible&&function(t){const e=t.plugins.get("ContextualBalloon");if(t.plugins.get("ComponentBoxUtil").getClosestSelectedWidget(t.editing.view.document.selection)){const o=x(t);e.updatePosition(o)}}(t):this._hideForm(!0)}))}_showForm(){if(this._isVisible)return;this._form||this._createForm();const t=this.editor;var e;(this._form.disableCssTransitions(),this._isInBalloon)||(null===(e=this._balloon)||void 0===e||e.add({view:this._form,position:x(t)}));this._form.enableCssTransitions()}_hideForm(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._isInBalloon&&(this._form.focusTracker.isFocused&&this._form.saveButtonView.focus(),this._balloon.remove(this._form),t&&this.editor.editing.view.focus())}init(){this._createButton()}}return class extends r{static get pluginName(){return"ComponentBoxToolbar"}static get requires(){return[_,v]}afterInit(){const t=this.editor,e=t.plugins.get("ComponentBoxUtil");t.plugins.get(g).register("componentBox",{items:["componentBoxProps"],getRelatedElement:e.getClosestSelectedWidget})}}},c=t=>{const{core:e}=t,{Plugin:o}=e,s=n(t),c=i(t),l=r(t);return class extends o{static get pluginName(){return"ComponentBox"}static get requires(){return[s,c,l]}}}}}]);
//# sourceMappingURL=986.a42d068e.chunk.js.map