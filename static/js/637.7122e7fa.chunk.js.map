{"version":3,"file":"static/js/637.7122e7fa.chunk.js","mappings":"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","sources":["components/OssUploadAdapterPlugin/index.js","components/OssUploadAdapterPlugin/img_fail.svg"],"sourcesContent":["import imgFail from './img_fail.svg';\n\nconst resizeBase64Image = (base64, width, height) => {\n    return new Promise((resolve, reject) => {\n        const img = new Image();\n        img.src = base64;\n\n        img.onload = function () {\n            // 创建一个 Canvas 元素\n            const canvas = document.createElement('canvas');\n            const ctx = canvas.getContext('2d');\n\n            const wRatio = img.width / width, hRatio = img.height / height;\n            const ratio = Math.max(wRatio, hRatio, 1);\n\n            // 设置 Canvas 的宽度和高度为缩放后的尺寸\n            canvas.width = img.width / ratio;\n            canvas.height = img.height / ratio;\n\n            // 将图片绘制到 Canvas 上，并缩放\n            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n\n            // 从 Canvas 中获取缩放后的图片数据，并将其转换为 Base64 格式\n            const resizedBase64 = canvas.toDataURL('image/png'); // 可以根据需要更改图片格式\n            // 调用回调函数，返回缩放后的 Base64 图片\n            resolve(resizedBase64);\n        };\n\n        img.onerror = function (error) {\n            reject(error);\n        };\n    });\n}\n\nclass OssUploadAdapter {\n    constructor(loader, options) {\n        this.loader = loader;\n        this.options = options;\n        this.base64MaxWidth = options.base64MaxWidth || 600;\n        this.base64MaxHeight = options.base64MaxHeight || 600;\n    }\n\n    async upload() {\n        const file = await this.loader.file;\n        if (typeof this.options.upload !== 'function') {\n            console.warn('当前图片上传为base64模式，正式环境请在preset apis设置file.upload,或者给CKEditor组件传入 config.ossUpload.upload参数');\n            const data = await new Promise(resolve => {\n                const fileReader = new FileReader();\n                fileReader.onload = () => {\n                    resolve(fileReader.result);\n                };\n                fileReader.readAsDataURL(file);\n            });\n\n            return {\n                default: await resizeBase64Image(data, this.base64MaxWidth, this.base64MaxHeight)\n            };\n        }\n        const {data: resData} = await this.options.upload({file});\n        if (resData.code !== 0) {\n            this.options.message.error(resData.msg);\n            return {default: imgFail};\n        }\n        return {\n            default: resData.data\n        };\n    }\n}\n\nfunction OssUploadAdapterPlugin(editor) {\n    const message = editor.config.get('message');\n    const options = Object.assign({}, {message}, editor.config.get('ossUpload'));\n    editor.plugins.get('FileRepository').createUploadAdapter = loader => {\n        return new OssUploadAdapter(loader, options);\n    };\n    editor.editing.view.document.on('clipboardInput', (evt, data) => {\n        if (editor.isReadOnly) {\n            return;\n        }\n\n        const dataTransfer = data.dataTransfer;\n        const html = dataTransfer.getData('text/html');\n        const parser = new DOMParser();\n        const domDocument = parser.parseFromString(html, 'text/html');\n        if (domDocument.querySelectorAll('img').length === 0) {\n            return;\n        }\n        data.content = editor.data.htmlProcessor.toView('');\n        const loadingClose = message.loading('粘贴内容中含有图片，正在进行图片上传...', {duration: 0});\n        Promise.all([].slice.call(domDocument.querySelectorAll('img'), 0).map(async img => {\n            if (typeof options.uploadUrl !== 'function') {\n                console.warn('图片上传失败，请在preset apis设置file.uploadUrl,或者给CKEditor组件传入 config.ossUpload.uploadUrl参数');\n                return;\n            }\n            const {code, data, msg} = await options.uploadUrl({url: img.src});\n            if (code !== 0) {\n                console.warn(`图片上传失败，${msg}`);\n                img.src = imgFail;\n                return;\n            }\n            img.src = data;\n        }))\n            .then(() => {\n                editor.model.insertContent(editor.data.toModel(editor.data.htmlProcessor.toView(domDocument.documentElement.outerHTML)));\n            })\n            .finally(() => {\n                loadingClose();\n            });\n    });\n}\n\nexport default OssUploadAdapterPlugin;\n","var _path, _path2;\nfunction _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }\nimport * as React from \"react\";\nfunction SvgImgFail(_ref, svgRef) {\n  let {\n    title,\n    titleId,\n    ...props\n  } = _ref;\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    t: 1695715120961,\n    className: \"icon\",\n    viewBox: \"0 0 1024 1024\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    \"p-id\": 2413,\n    xmlnsXlink: \"http://www.w3.org/1999/xlink\",\n    width: 200,\n    height: 200,\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M696.43 465.25c40.61 0 73.53-32.72 73.53-73.09s-32.96-73.08-73.53-73.08-73.54 32.72-73.54 73.08 32.92 73.09 73.54 73.09zM535.74 650.62l-273.61-259.4a56.19 56.19 0 0 0-15.36 11.58l-114 119.63-6-222.77c-0.73-26.82 20.84-49.41 47.67-50.14l201.77-5.44 47.34-50-250.43 6.75C119 202.33 76.33 247.17 77.78 301l7.32 271.4 4.5 166.78C91.06 793 136.05 835.47 190.2 834l176-4.75 12-0.32 47.34-50 116.18-122.64z\",\n    \"p-id\": 2414\n  })), _path2 || (_path2 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M861.71 214.8l-242.83-33.86-55.09 41.46L855 263a49.05 49.05 0 0 1 41.79 55.13l-54.33 389.59-120.87-159.05A59.86 59.86 0 0 0 638.06 537l-44 33.08 65.07 86.15L603.84 698l-79.57 60.1-54.92 41.48 34.17 4.76 270.73 37.76a97.55 97.55 0 0 0 109.88-79.6 22.37 22.37 0 0 0 0.65-3.44l60.53-434.16c7.44-53.32-29.95-102.62-83.6-110.1z\",\n    \"p-id\": 2415\n  })));\n}\nconst ForwardRef = /*#__PURE__*/React.forwardRef(SvgImgFail);\nexport default __webpack_public_path__ + \"static/media/img_fail.92f698baf5c5ad60bf4437eb46f9525a.svg\";\nexport { ForwardRef as ReactComponent };"],"names":["OssUploadAdapter","constructor","loader","options","this","base64MaxWidth","base64MaxHeight","upload","file","console","warn","data","Promise","resolve","fileReader","FileReader","onload","result","readAsDataURL","default","base64","width","height","reject","img","Image","src","canvas","document","createElement","ctx","getContext","wRatio","hRatio","ratio","Math","max","drawImage","resizedBase64","toDataURL","onerror","error","resizeBase64Image","resData","code","message","msg","imgFail","editor","config","get","Object","assign","plugins","createUploadAdapter","editing","view","on","evt","isReadOnly","html","dataTransfer","getData","domDocument","DOMParser","parseFromString","querySelectorAll","length","content","htmlProcessor","toView","loadingClose","loading","duration","all","slice","call","map","async","uploadUrl","url","then","model","insertContent","toModel","documentElement","outerHTML","finally"],"sourceRoot":""}